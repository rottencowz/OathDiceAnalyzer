<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="elm.js"></script>
    <script src='https://cdn.plot.ly/plotly-2.8.3.min.js'></script>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.6/css/bootstrap.css">
</head>

<body>
    <div id="myapp"></div>
    <div id="offense-plotly"></div>
    <!-- <div id="defense-plotly"></div> -->
</body>

<script>
    var app = Elm.OathDice.init({
        node: document.getElementById('myapp')
    });

    app.ports.passBatchedRollsToPlotly.subscribe(function (message) {
        var xOffense = [];
        var xDefense = [];
        var offenseTotal = 0;
        var defenseTotal = 0;
        message[1].forEach((elem, i) => {
            xOffense[i] = Math.floor(elem.summarizedOffense[0]);
            xDefense[i] = elem.summarizedDefense[0] * Math.max(1, elem.summarizedDefense[1]);
            defenseTotal += xDefense[i];
        })
        var trace1 = {
            x: xOffense,
            name: 'Offense',
            autobinx: true,
            marker: {
                color: "rgba(255, 100, 102, 0.7)",
                line: {
                    color: "rgba(255, 100, 102, 1)",
                    width: 1
                }
            },
            opacity: 0.5,
            type: "histogram",
            histnorm: 'probability',
            xbins: { start: 0 },
            xaxis: "x",
            yaxis: "y"
        };

        var trace2 = {
            x: xDefense,
            autobinx: true,
            marker: {
                color: "rgba(100, 200, 102, 0.7)",
                line: {
                    color: "rgba(100, 200, 102, 1)",
                    width: 1
                }
            },
            name: "Defense",
            opacity: 0.75,
            type: "histogram",
            histnorm: 'probability',
            xbins: { start: 0 },
            xaxis: "x",
            yaxis: "y"
        };


        var trace3 = {
            name: "O",
            x: xOffense,
            marker: {
                color: "rgba(255, 100, 102, 0.7)",
                line: {
                    color: "rgba(255, 100, 102, 1)",
                    width: 1
                }
            },
            opacity: 0.5,
            type: "box",
            boxmean: 'sd',
            xaxis: 'x',
            yaxis: 'y2',
        };

        var trace4 = {
            name: "D",
            x: xDefense,
            marker: {
                color: "rgba(100, 200, 102, 0.7)",
                line: {
                    color: "rgba(100, 200, 102, 1)",
                    width: 1
                }
            },
            opacity: 0.5,
            type: "box",
            boxmean: 'sd',
            xaxis: 'x',
            yaxis: 'y2',
        };
        var data = [trace1, trace2, trace3, trace4];

        var layout = {
            bargap: 0.05,
            bargroupgap: 0.2,
            barmode: "overlay",
            title: "Offense vs Defense",
            xaxis: { title: "Count" },
            yaxis: { title: "Probability" },
            grid: { rows: 2, columns: 1 },
        };

        Plotly.newPlot('offense-plotly', data, layout, { staticPlot: true });
        // Plotly.newPlot('defense-plotly', [trace3], layout);
    })

    app.ports.passRollToPlotly.subscribe(function (message) {
        // 
    });
</script>

</html>